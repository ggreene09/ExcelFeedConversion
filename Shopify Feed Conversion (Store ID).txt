Sub Shopify_to_ShareASale()

'ENTER MERCHANT ID and PLACEHOLDER CATEGORY/SUBCATEGORY VARIABLES
    Dim merchantID As Variant
    merchantID = InputBox("Enter Your ShareASale Merchant ID")
    Dim category As Variant
    category = InputBox("Enter a Default Product Category Value - Must be a Number")
    Dim subCategory As Variant
    subCategory = InputBox("Enter a Default Product Sub Category Value - Must be a Number")
    Dim path As Variant
    path = InputBox("Enter Your Website URL")

'Step 1: Delete Columns Not Matching ShareASale Format
    Dim currentColumn As Integer
    Dim columnHeading As String

    ActiveSheet.Columns("L").Delete

    For currentColumn = ActiveSheet.UsedRange.Columns.Count To 1 Step -1

        columnHeading = ActiveSheet.UsedRange.Cells(1, currentColumn).Value

        Select Case columnHeading
            Case "Handle", "Title", "Variant SKU", "Body (HTML)", "Image Src", "Vendor", "Variant Price"
            Case Else
                If InStr(1, _
                   ActiveSheet.UsedRange.Cells(1, currentColumn).Value, _
                   "ABCXYZ", vbBinaryCompare) = 0 Then

                    ActiveSheet.Columns(currentColumn).Delete

                End If
        End Select
    Next

'Step 2: Delete Rows With Empty and Duplicate SKU Values
Columns("E:E").Select
Set rngRange = Selection.CurrentRegion
lngNumRows = rngRange.Rows.Count
lngFirstRow = rngRange.Row
lngLastRow = lngFirstRow + lngNumRows - 1
lngCompareColumn = ActiveCell.Column
For lngCurrentRow = lngLastRow To lngFirstRow Step -1
If (Cells(lngCurrentRow, lngCompareColumn).Text = "") Then _
Rows(lngCurrentRow).Delete
Next lngCurrentRow
    ActiveSheet.Range("A:AX").RemoveDuplicates Columns:=5, Header:=xlNo

'Step 3: Rearrange Remaining Columns
    Columns("D:D").Cut Destination:=Columns("U:U")
    Columns("C:C").Cut Destination:=Columns("K:K")
    Columns("A:A").Cut Destination:=Columns("C:C")
    Columns("E:E").Cut Destination:=Columns("A:A")
    Columns("F:F").Cut Destination:=Columns("D:D")
    Columns("G:G").Cut Destination:=Columns("F:F")

'Step 4: Build Out Product URLs
Range("C:C").Select
Range("C2").Activate
Dim c As Range
For Each c In Selection
If c.Value <> "" Then c.Value = path & "/products/" & c.Value
Next

'Step 5: Add ShareASale Headers
[A1].Value = "SKU"
[B1].Value = "Name"
[C1].Value = "URL"
[D1].Value = "Price"
[E1].Value = "RetailPrice"
[F1].Value = "FullImage"
[G1].Value = "ThumbnailImage"
[H1].Value = "Commission"
[I1].Value = "Category"
[J1].Value = "Subcategory"
[K1].Value = "Description"
[L1].Value = "SearchTerms"
[M1].Value = "Status"
[N1].Value = "MerchantID"
[O1].Value = "Custom1"
[P1].Value = "Custom2"
[Q1].Value = "Custom3"
[R1].Value = "Custom4"
[S1].Value = "Custom5"
[T1].Value = "StoreID"
[U1].Value = "Manufacturer"
[V1].Value = "PartNumber"
[W1].Value = "MerchantCategory"
[X1].Value = "MerchantSubcategory"
[Y1].Value = "ShortDescription"
[Z1].Value = "ISBN"
[AA1].Value = "UPC"
[AB1].Value = "CrossSell"
[AC1].Value = "MerchantGroup"
[AD1].Value = "MerchantSubgroup"
[AE1].Value = "CompatibleWith"
[AF1].Value = "CompareTo"
[AG1].Value = "QuantityDiscount"
[AH1].Value = "Bestseller"
[AI1].Value = "AddToCartURL"
[AJ1].Value = "ReviewsRSSURL"
[AK1].Value = "Option1"
[AL1].Value = "Option2"
[AM1].Value = "Option3"
[AN1].Value = "Option4"
[AO1].Value = "Option5"
[AP1].Value = "customCommissions"
[AQ1].Value = "customCommissionisFlatRate"
[AR1].Value = "customCommissionNewCustomerMultiplier"
[AS1].Value = "mobileURL"
[AT1].Value = "mobileImage"
[AU1].Value = "mobileThumbnail"
[AV1].Value = "ReservedForFutureUse"
[AW1].Value = "ReservedForFutureUse"
[AX1].Value = "ReservedForFutureUse"
[AY1].Value = "ReservedForFutureUse"

'Step 6: Add Merchant ID and Placeholder Category/Subcategory Integers
    Dim LastRow As Long
    LastRow = Cells(Rows.Count, "A").End(xlUp).Row
    Range("N2:N" & LastRow).Value = merchantID
    Range("I2:I" & LastRow).Value = category
    Range("J2:J" & LastRow).Value = subCategory

'Step 7: Clean Out HTML, Line Breaks and Unsupported/Encoded Characters
Dim sht As Worksheet
Dim fndList As Variant
Dim rplcList As Variant
Dim x As Long

fndList = Array("<*>", "Â", "€“", "&amp;", "ï»¿", "//products", "&lt;", "&gt;")
rplcList = Array("", "", "", "&", "", "/products", "<", ">")

  For x = LBound(fndList) To UBound(fndList)
      For Each sht In ActiveWorkbook.Worksheets
        sht.Cells.Replace What:=fndList(x), Replacement:=rplcList(x), _
          LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, _
          SearchFormat:=False, ReplaceFormat:=False
      Next sht
  
  Next x
    Cells.Replace What:="" & Chr(10) & "", Replacement:=" ", LookAt:=xlPart, SearchOrder _
        :=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
    Cells.Replace What:="" & Chr(160) & "", Replacement:=" ", LookAt:=xlPart, SearchOrder _
        :=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False

'Step 8: Make it Look Nice
    Range("A:AY").Select
    Range("A1").Activate
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlBottom
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With

Range("AY:AY").Formula = "=TRIM(K1)"
Range("AY:AY").Formula = Range("AY:AY").Value
Columns("AY:AY").Cut Destination:=Columns("K:K")
[AY1].Value = "ReservedForFutureUse"

End Sub
